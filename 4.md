Section 4
=========

~.~.~.~.~.~.~. Chapter 4. 1 ~.~.~.~.~.~.~.
---------

```bash
 mysql -u root -p
```

```sql
    CREATE DATABASE cinder;
```

```sql
    GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' IDENTIFIED BY 'password';
```
```sql
    GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' IDENTIFIED BY 'password';
```
```sql
    exit;
```

```bash
 source admin-openrc
```

```bash
    openstack user create --domain default --password-prompt cinder
```

```bash
    openstack role add --project service --user cinder admin
```

```bash
    openstack service create --name cinder --description "OpenStack Block Storage" volume
```

```bash
    openstack service create --name cinderv2 --description "OpenStack Block Storage" volumev2
```

```bash
    openstack endpoint create --region RegionOne volume public http://control:8776/v1/%\(tenant_id\)s
```

```bash
    openstack endpoint create --region RegionOne volume internal http://control:8776/v1/%\(tenant_id\)s
```

```bash
    openstack endpoint create --region RegionOne volume admin http://control:8776/v1/%\(tenant_id\)s
```

```bash
openstack endpoint create --region RegionOne volumev2 public http://control:8776/v2/%\(tenant_id\)s
```


```bash
openstack endpoint create --region RegionOne volumev2 internal http://control:8776/v2/%\(tenant_id\)s
```

```bash
openstack endpoint create --region RegionOne volumev2 admin http://control:8776/v2/%\(tenant_id\)s
```

```bash
  apt-get install cinder-api cinder-scheduler
```

```bash
  cat /etc/cinder/cinder.conf | grep "^[^#$]" > cinder.conf.bkp
```

  [DEFAULT]
    
    my_ip = 10.10.10.2
    auth_strategy = keystone
    rpc_backend = rabbit
    ...
    
    [database]
    
    connection = mysql+pymysql://cinder:password@control/cinder
    ...
    
    [keystone_authtoken]
    
    auth_uri = http://control:5000
    auth_url = http://control:35357
    memcached_servers = control:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = cinder
    password = password
    ...
    
    [oslo_messaging_rabbit]
    
    rabbit_host = control
    rabbit_userid = openstack
    rabbit_password = password
    ...
    
    [oslo_concurrency]

    lock_path = /var/lib/cinder/tmp
    ...
    

```bash
  su -s /bin/sh -c "cinder-manage db sync" cinder
```

```bash
  vi /etc/nova/nova.conf 
```

    [cinder]
    os_region_name = RegionOne


```bash
  service nova-api restart
```

```bash
  for service in scheduler api; do
  service cinder-$service restart
  done 
```

On Storage node

```bash
  apt-get install lvm2
```

```bash
  pvcreate /dev/sdb
```

```bash
  gcreate cinder-volumes /dev/sdb
```

```bash
vgs -vvvv
```

```bash
  apt-get install cinder-volume
```

```bash
  cat /etc/cinder/cinder.conf | grep "^[^#$]" > cinder.conf.bkp
```

```bash
  vi /etc/cinder/cinder.conf
```

    [DEFAULT]
    
    enabled_backends = lvm
    glance_api_servers = http://control:9292
    ...
    
    [lvm]
    
    volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver
    volume_group = cinder-volumes
    iscsi_protocol = iscsi
    iscsi_helper = tgtadm
    ...
    
    
    [oslo_concurrency]
 
    lock_path = /var/lib/cinder/tmp
    ...

```bash
 service tgt restart
 service cinder-volume restart
```

```bash
 source admin.opensrc.sh
```

```bash
 cinder service-list
```